---
// src/layouts/Base.astro
import "../styles/global.css";
import Footer from "../components/Footer.astro";

const {
  title = "Denver Black Guide",
  description = "A community-driven directory to discover and support Black-owned businesses in the Denver metro area.",
  image = "/og-denver-black-guide.png",
  canonical: canonicalProp,
  jsonLd, // optional page-specific JSON-LD
  robots = "index,follow,max-image-preview:large",
  ogType = "website", // âœ… NEW: "website" by default, optionally "article"
  ogLocale = "en_US", // âœ… NEW
  ogSiteName = "Denver Black Guide", // âœ… NEW
  ogImageAlt = "Denver Black Guide directory preview image", // âœ… NEW
} = Astro.props;

// Prefer Astro.site (from astro.config.mjs). Fallback to current origin.
const origin =
  import.meta.env.SITE_URL ||
  "https://denverblackguide.com";

const siteUrl = new URL("/", origin).toString();

const canonical = canonicalProp
  ? canonicalProp
  : new URL(Astro.url.pathname, origin).toString();

const absoluteImage = new URL(image, origin).toString();

/**
 * Safely serialize JSON-LD for <script type="application/ld+json">
 */
function safeJsonLd(data: unknown) {
  return JSON.stringify(data)
    .replace(/</g, "\\u003c")
    .replace(/>/g, "\\u003e")
    .replace(/&/g, "\\u0026")
    .replace(/\u2028/g, "\\u2028")
    .replace(/\u2029/g, "\\u2029");
}

// Always-present global structured data
const globalJsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": `${siteUrl}#organization`,
      name: "Denver Black Guide",
      url: siteUrl,
      // If you add a real logo asset later:
      // logo: new URL("/logo.png", origin).toString(),
    },
    {
      "@type": "WebSite",
      "@id": `${siteUrl}#website`,
      url: siteUrl,
      name: "Denver Black Guide",
      publisher: { "@id": `${siteUrl}#organization` },
      potentialAction: {
        "@type": "SearchAction",
        target: `${new URL("/all", origin).toString()}?q={search_term_string}`,
        "query-input": "required name=search_term_string",
      },
    },
  ],
};
---

<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <title>{title}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="description" content={description} />
    <meta name="robots" content={robots} />
    <link rel="canonical" href={canonical} />
    <link rel="sitemap" href="/sitemap-index.xml" />

    <!-- Favicons -->
    <link rel="icon" href="/favicon.ico" sizes="any" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />




    <!-- Open Graph -->
    <meta property="og:type" content={ogType} />
    <meta property="og:site_name" content={ogSiteName} />
    <meta property="og:locale" content={ogLocale} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonical} />
    <meta property="og:image" content={absoluteImage} />
    <meta property="og:image:alt" content={ogImageAlt} />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={absoluteImage} />
    <meta name="twitter:image:alt" content={ogImageAlt} />

    <!-- âœ… JSON-LD: global (always) -->
    <script type="application/ld+json" set:html={safeJsonLd(globalJsonLd)} />

    <!-- âœ… JSON-LD: page-specific (optional) -->
    {jsonLd && (
      <script type="application/ld+json" set:html={safeJsonLd(jsonLd)} />
    )}

    <!-- Leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Extra head slot -->
    <slot name="head" />

    <!-- initial theme -->
    <script is:inline>
      (function () {
        try {
          const stored = localStorage.getItem("theme");
          const prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;
          const theme = stored || (prefersDark ? "dark" : "light");
          document.documentElement.dataset.theme = theme;
        } catch (e) {
          document.documentElement.dataset.theme = "light";
        }
      })();
    </script>
  </head>

  <body>
    <header class="site-header">
      <div class="shell site-header__inner">
        <a href="/" class="site-header__brand">
          <span class="site-header__logo" aria-hidden="true">
  <svg
    class="site-header__logo-icon"
    viewBox="0 0 64 64"
    aria-hidden="true"
    focusable="false"
  >
    <!-- Fill with heart punched out -->
    <path
      fill="#A856F6"
      fill-rule="evenodd"
      d="
        M32 60
        C44 44 52 32 52 22
        C52 10.954 43.046 2 32 2
        C20.954 2 12 10.954 12 22
        C12 32 20 44 32 60
        Z

        M32 37.5
        C25.3 33.0 21 28.8 21 23.7
        C21 20.0 23.6 17.5 27 17.5
        C29.3 17.5 31.1 18.7 32 20.2
        C32.9 18.7 34.7 17.5 37 17.5
        C40.4 17.5 43 20.0 43 23.7
        C43 28.8 38.7 33.0 32 37.5
        Z
      "
    />

    <!-- Outline (no heart stroke) -->
    <path
      d="
        M32 60
        C44 44 52 32 52 22
        C52 10.954 43.046 2 32 2
        C20.954 2 12 10.954 12 22
        C12 32 20 44 32 60
        Z
      "
      fill="none"
      stroke="#131735"
      stroke-width="3"
      stroke-linejoin="round"
    />
  </svg>
</span>



          <span class="site-header__title">Denver Black Guide</span>
        </a>

        <nav class="site-header__nav" aria-label="Primary navigation">
          <a href="/about/" class="site-header__link">About</a>
          <a href="/contact/" class="site-header__link">Contact</a>

          <button
            id="themeToggle"
            type="button"
            class="theme-toggle"
            aria-label="Toggle color theme"
            aria-pressed="false"
          >
            <span class="theme-toggle__icon" aria-hidden="true">ðŸŒž</span>
            <span class="theme-toggle__label">Light</span>
          </button>
        </nav>
      </div>
    </header>

    <div class="site-hero" aria-hidden="false">
      <img
        src="/denver-skyline-v1.png"
        alt="Watercolor illustration of the Denver skyline with mountains at sunset"
        class="site-hero__image"
      />
    </div>

    <main class="shell site-main">
      <slot />
    </main>

    <Footer />

    <script is:inline>
      (function () {
        const root = document.documentElement;
        const btn = document.getElementById("themeToggle");
        if (!btn) return;

        function getTheme() {
          return root.dataset.theme === "dark" ? "dark" : "light";
        }

        function applyTheme(theme) {
          root.dataset.theme = theme;
          try { localStorage.setItem("theme", theme); } catch (e) {}

          const icon = btn.querySelector(".theme-toggle__icon");
          const label = btn.querySelector(".theme-toggle__label");

          if (theme === "dark") {
            btn.setAttribute("aria-pressed", "true");
            if (icon) icon.textContent = "ðŸŒ™";
            if (label) label.textContent = "Dark";
          } else {
            btn.setAttribute("aria-pressed", "false");
            if (icon) icon.textContent = "ðŸŒž";
            if (label) label.textContent = "Light";
          }
        }

        applyTheme(getTheme());

        btn.addEventListener("click", () => {
          const next = getTheme() === "dark" ? "light" : "dark";
          applyTheme(next);
        });
      })();
    </script>
  </body>
</html>
