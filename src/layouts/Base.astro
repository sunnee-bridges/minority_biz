---
// src/layouts/Base.astro
import "../styles/global.css";
import Footer from "../components/Footer.astro";

const {
  title = "Local Food Directory",
  description = "Directory of local restaurants, food trucks, caterers, and bakeries with filters for cuisine, neighborhood, and amenities."
} = Astro.props;
---

<html lang="en" data-theme="light">
  <head>
  <meta charset="utf-8" />
  <title>{title}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content={description} />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  
  <!-- Add Leaflet CSS and JS (NO SPACE in version!) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- Slot for additional head content -->
  <slot name="head" />
  
  <!-- üåì Set initial theme before paint -->
  <script is:inline>
    (function () {
      try {
        const stored = localStorage.getItem("theme");
        const prefersDark =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches;
        const theme = stored || (prefersDark ? "dark" : "light");
        document.documentElement.dataset.theme = theme;
      } catch (e) {
        document.documentElement.dataset.theme = "light";
      }
    })();
  </script>
</head>

  <body>
    <header class="site-header">
      <div class="shell site-header__inner">
        <a href="/" class="site-header__brand">
          <span class="site-header__logo" aria-hidden="true">üçΩÔ∏è</span>
          <span class="site-header__title">Local Food Directory</span>
        </a>

        <nav class="site-header__nav" aria-label="Primary navigation">
          <a href="/" class="site-header__link">Directory</a>

          <button
            id="themeToggle"
            type="button"
            class="theme-toggle"
            aria-label="Toggle color theme"
            aria-pressed="false"
          >
            <span class="theme-toggle__icon" aria-hidden="true">üåû</span>
            <span class="theme-toggle__label">Light</span>
          </button>
        </nav>
      </div>
    </header>

    <main class="shell site-main">
      <slot />
    </main>

    <Footer />

    <!-- üåì Theme toggle logic -->
    <script is:inline>
      (function () {
        const root = document.documentElement;
        const btn = document.getElementById("themeToggle");
        if (!btn) return;

        function getTheme() {
          return root.dataset.theme === "dark" ? "dark" : "light";
        }

        function applyTheme(theme) {
          root.dataset.theme = theme;
          try {
            localStorage.setItem("theme", theme);
          } catch (e) {}

          const icon = btn.querySelector(".theme-toggle__icon");
          const label = btn.querySelector(".theme-toggle__label");

          if (theme === "dark") {
            btn.setAttribute("aria-pressed", "true");
            if (icon) icon.textContent = "üåô";
            if (label) label.textContent = "Dark";
          } else {
            btn.setAttribute("aria-pressed", "false");
            if (icon) icon.textContent = "üåû";
            if (label) label.textContent = "Light";
          }
        }

        // Initialize from current theme
        applyTheme(getTheme());

        btn.addEventListener("click", () => {
          const next = getTheme() === "dark" ? "light" : "dark";
          applyTheme(next);
        });
      })();
    </script>
  </body>
</html>
